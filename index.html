<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium Support Proration Calculator (GBP)</title>
  <style>
    :root {
      --bg: #0b0c0c;        /* dark header */
      --card: #ffffff;      /* white card */
      --ink: #111827;       /* slate-900 */
      --muted: #6b7280;     /* slate-500 */
      --brand: #2563eb;     /* blue-600 */
      --brand-2: #1d4ed8;   /* blue-700 */
      --ring: rgba(37, 99, 235, 0.3);
    }

    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink); background: #f3f4f6; }

    header { background: var(--bg); color: white; padding: 1.25rem 1rem; }
    header h1 { margin: 0; font-size: 1.125rem; font-weight: 700; }
    header p { margin: .25rem 0 0; font-size: .9rem; color: #e5e7eb; }

    .wrap { max-width: 920px; margin: 1.5rem auto; padding: 0 1rem; }

    .card { background: var(--card); border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,.06); padding: 1.25rem; }
    .grid { display: grid; gap: 1rem; grid-template-columns: repeat(12, minmax(0, 1fr)); }
    .col-6 { grid-column: span 6; }
    .col-4 { grid-column: span 4; }
    .col-8 { grid-column: span 8; }
    .col-12 { grid-column: span 12; }

    @media (max-width: 800px) { .col-6, .col-4, .col-8 { grid-column: span 12; } }

    label { display: block; font-weight: 600; font-size: .95rem; margin-bottom: .35rem; }
    .hint { font-size: .8rem; color: var(--muted); margin-top: .25rem; }

    input[type="date"], input[type="number"], input[type="text"] { width: 100%; padding: .65rem .7rem; border: 1px solid #e5e7eb; border-radius: 10px; outline: none; font-size: 1rem; transition: box-shadow .15s, border-color .15s; background: #fff; }
    input[readonly] { background: #f9fafb; color: #6b7280; }

    input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--ring); }

    .radio-row { display: flex; gap: 1rem; flex-wrap: wrap; }
    .radio { display: flex; align-items: center; gap: .5rem; padding: .5rem .7rem; border: 1px solid #e5e7eb; border-radius: 999px; cursor: pointer; }

    .btn { display: inline-flex; align-items: center; gap: .5rem; padding: .7rem 1rem; border-radius: 10px; border: 1px solid var(--brand); background: var(--brand); color: white; font-weight: 700; cursor: pointer; transition: transform .05s ease, background .15s; }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: #fff; color: var(--brand-2); }

    .kpi { background: #f9fafb; border: 1px dashed #e5e7eb; border-radius: 12px; padding: .9rem; display: grid; gap: .35rem; }
    .kpi b { font-size: 1.1rem; }
    .pill { display: inline-block; padding: .2rem .55rem; border-radius: 999px; background: #eef2ff; color: #3730a3; font-weight: 700; font-size: .75rem; }

    .total { background: #ecfdf5; border: 1px solid #a7f3d0; }
    .warning { background: #fffbeb; border: 1px solid #fde68a; }

    .footer { color: var(--muted); font-size: .85rem; margin-top: 1rem; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <header>
    <h1>Premium Support Proration Calculator (GBP)</h1>
    <p>Upgrade customers from <strong>Basic (£495 already paid)</strong> to <strong>Premium (£895)</strong>, charging only for the remaining period.</p>
  </header>

  <main class="wrap">
    <section class="card" aria-labelledby="calcTitle">
      <h2 id="calcTitle" class="sr-only">Calculator</h2>

      <div class="grid">
        <div class="col-6">
          <label for="startDate">Premium start date</label>
          <input id="startDate" type="date" />
          <div class="hint">Set the date Premium cover begins (editable — defaults to today).</div>
        </div>
        <div class="col-6">
          <label for="renewalDate">Annual renewal date</label>
          <input id="renewalDate" type="date" />
          <div class="hint">Next renewal date for the customer's current support term.</div>
        </div>

        <div class="col-4">
          <label for="daysRemaining">Days between start and renewal</label>
          <input id="daysRemaining" type="number" inputmode="numeric" min="0" step="1" />
          <div class="hint">Auto-calculated from dates (you can override if needed).</div>
        </div>
        <div class="col-4">
          <label for="premiumAnnual">Premium annual fee</label>
          <input id="premiumAnnual" type="number" inputmode="decimal" min="0" step="0.01" value="895" />
          <div class="hint">£ per year for Premium.</div>
        </div>
        <div class="col-4">
          <label for="basicAnnual">Basic annual fee (already paid)</label>
          <input id="basicAnnual" type="number" inputmode="decimal" min="0" step="0.01" value="495" />
          <div class="hint">£ per year for Basic (deducted automatically in Upgrade mode).</div>
        </div>

        <div class="col-12">
          <label>Calculation method</label>
          <div class="radio-row" role="radiogroup" aria-label="Calculation method">
            <label class="radio"><input type="radio" name="mode" value="upgrade" checked /> Upgrade difference (Premium − Basic)</label>
            <label class="radio"><input type="radio" name="mode" value="full" /> Full Premium (ignore Basic already paid)</label>
          </div>
          <div class="hint">Upgrade difference charges only the additional amount for moving from Basic → Premium for the remaining days. This automatically takes the £495 already paid into account.</div>
        </div>

        <div class="col-6 kpi">
          <span class="pill">Daily rate</span>
          <div><span id="dailyLabel">Upgrade daily rate</span>: <b id="dailyRate">£0.00</b></div>
          <div class="hint">Uses the year length for the renewal year (365 or 366 days).</div>
        </div>
        <div class="col-6 kpi total">
          <span class="pill">Amount to charge now</span>
          <div>Prorated total for <span id="daysLabel">0</span> day(s): <b id="total">£0.00</b></div>
          <div class="hint">Rounded to the nearest penny.</div>
        </div>

        <div class="col-12">
          <button class="btn" id="recalc">Recalculate</button>
          <button class="btn secondary" id="copy">Copy summary</button>
        </div>

        <div class="col-12 kpi warning" id="note" hidden>
          <span class="pill">Heads‑up</span>
          <div id="noteText"></div>
        </div>

        <div class="col-12 footer">
          <strong>How it works:</strong>
          <div>Daily rate = <code>(Annual amount) ÷ (days in year)</code>.</div>
          <div>If <em>Upgrade difference</em> is selected, the annual amount is <code>Premium − Basic</code> (so the £495 already paid is deducted evenly across the year). Otherwise it is <code>Premium</code>.</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    (function() {
      const £ = (n) => new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(n || 0);

      const els = {
        startDate: document.getElementById('startDate'),
        renewalDate: document.getElementById('renewalDate'),
        daysRemaining: document.getElementById('daysRemaining'),
        premiumAnnual: document.getElementById('premiumAnnual'),
        basicAnnual: document.getElementById('basicAnnual'),
        dailyRate: document.getElementById('dailyRate'),
        dailyLabel: document.getElementById('dailyLabel'),
        daysLabel: document.getElementById('daysLabel'),
        total: document.getElementById('total'),
        recalc: document.getElementById('recalc'),
        copy: document.getElementById('copy'),
        note: document.getElementById('note'),
        noteText: document.getElementById('noteText')
      };

      const isLeapYear = (y) => (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);

      function daysBetweenUTC(a, b) {
        const msPerDay = 24*60*60*1000;
        const d1 = Date.UTC(a.getUTCFullYear(), a.getUTCMonth(), a.getUTCDate());
        const d2 = Date.UTC(b.getUTCFullYear(), b.getUTCMonth(), b.getUTCDate());
        return Math.max(0, Math.ceil((d2 - d1) / msPerDay));
      }

      function calc() {
        const startStr = els.startDate.value;
        const renewalStr = els.renewalDate.value;
        const premium = Number(els.premiumAnnual.value || 0);
        const basic = Number(els.basicAnnual.value || 0);
        const mode = document.querySelector('input[name="mode"]:checked')?.value || 'upgrade';
        els.dailyLabel.textContent = (mode === 'upgrade') ? 'Upgrade daily rate (Premium − Basic)' : 'Premium daily rate';

        els.note.hidden = true; els.noteText.textContent = '';

        let daysRemaining = Number(els.daysRemaining.value);

        if (startStr && renewalStr) {
          const start = new Date(startStr + 'T12:00:00');
          const renewal = new Date(renewalStr + 'T12:00:00');

          const d = daysBetweenUTC(start, renewal);
          if (!Number.isFinite(daysRemaining) || daysRemaining <= 0 || Math.abs(d - daysRemaining) > 1) {
            daysRemaining = d;
            els.daysRemaining.value = String(d);
          }

          if (d === 0) {
            els.note.hidden = false;
            els.noteText.textContent = 'Start date equals renewal date. Charge only one day if upgrading just for today.';
          }

          if (renewal <= start) {
            els.note.hidden = false;
            els.noteText.textContent = 'Renewal date must be after the Premium start date.';
          }
        }

        if (!Number.isFinite(daysRemaining) || daysRemaining < 0) daysRemaining = 0;

        const yearForRate = els.renewalDate.value ? new Date(els.renewalDate.value).getUTCFullYear() : (new Date()).getUTCFullYear();
        const daysInYear = isLeapYear(yearForRate) ? 366 : 365;

        const annualAmount = (mode === 'upgrade') ? Math.max(0, premium - basic) : premium;
        const dailyRate = (daysInYear > 0) ? (annualAmount / daysInYear) : 0;
        const total = dailyRate * daysRemaining;

        els.dailyRate.textContent = £(dailyRate);
        els.daysLabel.textContent = String(daysRemaining);
        els.total.textContent = £(Math.round(total * 100) / 100);
      }

      function copySummary() {
        const modeLabel = document.querySelector('input[name="mode"]:checked')?.value === 'upgrade' ? 'Upgrade difference' : 'Full Premium';
        const txt = [
          `Mode: ${modeLabel}`,
          `Premium annual: £${Number(els.premiumAnnual.value || 0).toFixed(2)}`,
          `Basic annual (already paid): £${Number(els.basicAnnual.value || 0).toFixed(2)}`,
          `Start date: ${els.startDate.value || '(not set)'}`,
          `Renewal date: ${els.renewalDate.value || '(not set)'}`,
          `Days to bill: ${els.daysRemaining.value || '0'}`,
          `Daily rate: ${els.dailyRate.textContent}`,
          `Prorated total: ${els.total.textContent}`
        ].join('\n');

        navigator.clipboard.writeText(txt).then(() => {
          els.copy.textContent = 'Copied!';
          setTimeout(() => (els.copy.textContent = 'Copy summary'), 1200);
        }).catch(() => {
          alert('Could not copy to clipboard.');
        });
      }

      ['change', 'input'].forEach(evt => {
        document.addEventListener(evt, (e) => {
          if (['startDate', 'renewalDate', 'daysRemaining', 'premiumAnnual', 'basicAnnual'].includes(e.target.id) || e.target.name === 'mode') calc();
        });
      });
      els.recalc.addEventListener('click', calc);
      els.copy.addEventListener('click', copySummary);

      // initialise: start = today; renewal = ~12 months from today
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      els.startDate.value = `${yyyy}-${mm}-${dd}`;

      const next = new Date(today);
      next.setDate(next.getDate() + 365);
      const ny = next.getFullYear();
      const nm = String(next.getMonth() + 1).padStart(2, '0');
      const nd = String(next.getDate()).padStart(2, '0');
      els.renewalDate.value = `${ny}-${nm}-${nd}`;

      calc();
    })();
  </script>
</body>
</html>
